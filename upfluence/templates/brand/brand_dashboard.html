{% extends "brand/brand_layout.html" %}

{% block section %}
<nav class="flex justify-between px-4 mx-auto w-full max-w-7xl items-center" aria-label="Breadcrumb">
  <ol class="inline-flex items-center space-x-1 md:space-x-3">
    <li class="inline-flex items-center">
      <a
        href="{{ url_for('brand.dashboard', brand_id=brand_id)}}"
        class="ml-1 inline-flex text-sm font-medium text-gray-800 hover:underline"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="mr-4 h-4 w-4"
        >
          <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
          <polyline points="9 22 9 12 15 12 15 22"></polyline>
        </svg>
        brand
      </a>
    </li>

    {% for crumb in url_for('brand.dashboard', brand_id=brand_id).split('/')[2:]  %}
        <li>
      <div class="flex items-center">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="h-4 w-4"
        >
          <polyline points="9 18 15 12 9 6"></polyline>
        </svg>
        <a
          href="#"
          class="ml-1 text-sm font-medium text-gray-800 hover:underline md:ml-2"
        >
          {{ crumb }}
        </a>
      </div>
    </li>
    {% endfor %}    
</ol>


     <div class="flex items-center gap-10">
     <div class="relative inline-block text-left">
        <button id="dropdownButton" type="button" class="inline-flex justify-center rounded-full shadow-sm bg-white text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500" aria-expanded="true" aria-haspopup="true">
            <img class="w-10 h-10 p-1 rounded-full " src="https://avatar.iran.liara.run/public/boy?username={prem}" alt="Bordered avatar">
        </button>

        <!-- Dropdown menu, show/hide based on menu state. -->
        <div id="dropdownMenu" class="hidden origin-top-right absolute right-0 mt-2 w-56 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 focus:outline-none" role="menu" aria-orientation="vertical" aria-labelledby="dropdownButton">
            <div class="py-1" role="none">
                <!-- Active: "bg-gray-100", Not Active: "" -->
                <button id="add-budget-btn" class="text-gray-700 block w-full text-left px-4 py-2 text-sm hover:bg-gray-200" role="menuitem">Add Budget</button>
                <a href="{{ url_for('brand.profile', brand_id=brand_id) }}" class="text-gray-700 block px-4 py-2 text-sm hover:bg-gray-200" role="menuitem">Profile</a>
                <button type="submit" class="text-gray-700 block w-full text-left px-4 py-2 text-sm hover:bg-gray-200" role="menuitem">Log out</button>
            </div>
        </div>
     </div>
    </div>
</nav>

<section class="mx-auto w-full max-w-7xl px-4 py-4 ">
  <div class="grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-4">
      <!-- Active Campaigns -->
  <div class="p-4 bg-yellow-200 rounded-lg shadow-md">
    <div class="flex items-center justify-between ">
      <div>
        <h2 class="text-lg font-semibold text-gray-700">Active Campaigns</h2>
        <p class="text-normal font-bold text-gray-900">{{ active_campaigns }} 3</p>
      </div>
    </div>
  </div>
    <!-- Total Payments Made -->
  <div class="p-4 bg-red-300 rounded-lg shadow-md">
    <div class="flex items-center justify-between ">
      <div>
        <h2 class="text-lg font-semibold text-gray-700">Total Payments Made</h2>
        <p class="text-normal font-bold text-gray-900">$ {{ total_payments_made }} 300</p>
      </div>
    </div>
  </div>
  <!-- Total Budget Utilized -->
  <div class="p-4 rounded-lg shadow-md bg-green-300">
    <div class="flex items-center justify-between ">
      <div>
        <h2 class="text-lg font-semibold text-gray-700">Total Budget Utilized</h2>
        <p class="text-normal font-bold text-gray-900">$ {{ total_budget_utilized }} 500</p>
      </div>
    </div>
  </div>
  <!-- Total Budget Left -->
  <div class="p-4 rounded-lg shadow-md bg-indigo-300">
    <div class="flex items-center justify-between ">
      <div>
        <h2 class="text-lg font-semibold text-gray-700">Total Budget Left</h2>
        <p class="text-normal font-bold text-gray-900">$ {{ total_budget_utilized }} 500</p>
      </div>
    </div>
  </div>
  
  
  <!-- Influencers Engaged -->
  <div class="p-4 bg-purple-300 rounded-lg shadow-md">
    <div class="flex items-center justify-between  ">
      <div>
        <h2 class="text-lg font-semibold text-gray-700">Influencers Engaged</h2>
        <p class="text-normal font-bold text-gray-900">{{ influencers_engaged }}</p>
      </div>
    </div>
  </div>

  <!-- Avg Sponsorship offered per influencer -->
  <div class="p-4 bg-lime-300 rounded-lg shadow-md">
    <div class="flex items-center justify-between ">
      <div>
        <h2 class="text-lg font-semibold text-gray-700">Avg Sponsorship offered</h2>
        <p class="text-normal font-bold text-gray-900">{{ influencers_engaged }}</p>
      </div>
    </div>
  </div>

  <!-- Cost per Engagement -->
  <div class="p-4 bg-orange-300 rounded-lg shadow-md">
    <div class="flex items-center justify-between">
      <div>
        <h2 class="text-lg font-semibold text-gray-700">Cost per Engagement</h2>
        <p class="text-normal font-bold text-gray-900">${{ cpe }} number_format(2)</p>
      </div>
    </div>
  </div>
  
  
  <!-- Proposals Sent -->
  
  <!-- Engagement Metrics -->
   <!-- 
  <div class="p-4 bg-white rounded-lg shadow-md">
    <div class="flex items-center justify-between bg-teal-100 ">
      <div>
        <h2 class="text-lg font-semibold text-gray-700">Engagement Metrics</h2>
        <p class="text-3xl font-bold text-gray-900">Likes: {{ total_likes }}</p>
        <p class="text-3xl font-bold text-gray-900">Comments: {{ total_comments }}</p>
        <p class="text-3xl font-bold text-gray-900">Shares: {{ total_shares }}</p>
        <p class="text-3xl font-bold text-gray-900">Views: {{ total_views }}</p>
      </div>
    </div>
  </div> -->

  <!-- ROI -->
  <div class="p-4 bg-emerald-300 rounded-lg shadow-md">
    <div class="flex items-center justify-between">
      <div>
        <h2 class="text-lg font-semibold text-gray-700">Engagement Rate</h2>
        <p class="text-normal font-bold text-gray-900">{{ roi }} %</p>
      </div>
    </div>
  </div>
  
  
  
  <!-- Campaign Performance -->
  <div class="p-4 bg-white rounded-lg shadow-md">
    <div>
      <h2 class="text-lg font-semibold text-gray-700">Campaign Performance</h2>
      <ul>
        {% for cp in campaign_performance %}
        <li>
          <h3 class="text-md font-semibold">{{ cp.campaign.name }}</h3>
          <p>Engagement Rate: {{ cp.engagement_rate }}%</p>
        </li>
        {% endfor %}
      </ul>
    </div>
  </div>
  
  <!-- Top Performing Influencers -->
  <div class="p-4 bg-white rounded-lg shadow-md">
    <div>
      <h2 class="text-lg font-semibold text-gray-700">Top Performing Influencers</h2>
      <ul>
        {% for ip in influencer_performance %}
        <li>
          <h3 class="text-md font-semibold">{{ ip.influencer.name }}</h3>
          <p>Engagements: {{ ip.engagements }}</p>
        </li>
        {% endfor %}
      </ul>
    </div>
  </div>
  
  <!-- Monthly Performance Trends -->
  <div class="p-4 bg-white rounded-lg shadow-md">
    <div>
      <h2 class="text-lg font-semibold text-gray-700">Monthly Performance Trends</h2>
      <ul>
        {% for mt in monthly_trends %}
        <li>
          <h3 class="text-md font-semibold">{{ mt.month }}</h3>
          <p>Budget: ${{ mt.budget }}</p>
          <p>Engagements: {{ mt.engagements }}</p>
          <p>Revenue: ${{ mt.revenue }}</p>
        </li>
        {% endfor %}
      </ul>
    </div>
  </div>
  
  <!-- Audience Demographics -->
  <div class="p-4 bg-white rounded-lg shadow-md">
    <div>
      <h2 class="text-lg font-semibold text-gray-700">Audience Demographics</h2>
      <ul>
        {% for ad in audience_demographics %}
        <li>
          <p>Age: {{ ad.audience_age }}</p>
          <p>Gender: {{ ad.audience_gender }}</p>
          <p>Location: {{ ad.audience_location }}</p>
        </li>
        {% endfor %}
      </ul>
    </div>
  </div>

</div>

</section>
{% endblock %}

{% block modal %}
  <div id="add-budget-modal" class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 flex justify-center items-center md:inset-0 h-[calc(100%-1rem)] max-h-full">
    <div class="relative  p-4 w-fit max-h-full">
        <!-- Modal content -->
        <div class="relative bg-violet-400 rounded-lg shadow ">
            <!-- Modal header -->
            <div class="flex items-center justify-between p-4 md:p-5 border-b rounded-t dark:border-gray-600">
                <h3 class="text-lg font-semibold text-gray-900">
                    Add Budget
                </h3>
                <button id="close-modal-btn" type="button" class="text-gray-600 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center" data-modal-toggle="crud-modal">
                    <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"/>
                    </svg>
                    <span class="sr-only">Close modal</span>
                </button>
            </div>

            <form id="add-budget-form" action="{{ url_for('brand.add_budget', brand_id=brand_id) }}" method="post" class="p-4 md:p-5">
              <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                <div class="grid gap-4 mb-4 grid-cols-2">
                    <div class="col-span-2 sm:col-span-1">
                        <label for="amount" class="block mb-2 text-sm font-medium text-gray-900 ">Amount</label>
                        <input type="number" name="amount" id="amount" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 " placeholder="$2999" required>
                    </div>
                </div>
                <button type="submit" class="text-white inline-flex items-center bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center">
                    Add
                </button>
            </form>
            
        </div>
    </div>
</div> 
{% endblock %}


{% block script %}
<script>
   document.getElementById('dropdownButton').addEventListener('click', function(event) {
            const menu = document.getElementById('dropdownMenu');
            const button = event.currentTarget;
            menu.classList.toggle('hidden');
            button.classList.toggle('bg-gray-100');
            button.classList.toggle('text-gray-900');
        })

        // Close dropdown when clicking outside
  document.addEventListener('click', function(event) {
      const menu = document.getElementById('dropdownMenu');
      const button = document.getElementById('dropdownButton');
      if (!button.contains(event.target) && !menu.contains(event.target)) {
          menu.classList.add('hidden');
          button.classList.remove('bg-gray-100');
          button.classList.remove('text-gray-900');
      }
  })


  const addBudgetBtn =  document.getElementById('add-budget-btn')
  const closeModalBtn = document.querySelector('#close-modal-btn')
  const form = document.querySelector('#add-budget-form')

  addBudgetBtn.addEventListener('click', function(e) {
    console.log('click')
    document.querySelector('#add-budget-modal').classList.remove('hidden')
    document.querySelector('#dashboard').classList.add('opacity-50')
    addBudgetBtn.removeEventListener('click', () => {})
  })

  closeModalBtn.addEventListener('click', function () {
    document.querySelector('#add-budget-modal').classList.add('hidden')
    document.querySelector('#dashboard').classList.remove('opacity-50')
    closeModalBtn.removeEventListener('click', () => {})
  })

  form.addEventListener('submit', function (){
    closeModalBtn.click()
    form.removeEventListener('submit')
  })
</script>
{% endblock %}